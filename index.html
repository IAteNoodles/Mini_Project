<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Manager</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(to right, #ece9e6, #ffffff);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1000px;
            margin: 2em auto;
            background: rgba(255, 255, 255, 0.9);
            padding: 2.5em;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        h1, h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 1em;
        }

        h1 {
            font-size: 2.5em;
        }

        h2 {
            font-size: 1.8em;
        }

        /* Form Styles */
        .form-section {
            margin-bottom: 3em;
            padding: 2em;
            background: #fdfdfd;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 15px;
            margin-bottom: 1.5em;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        input[type="text"]:focus, textarea:focus {
            border-color: #007BFF;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.2);
            outline: none;
        }

        /* Button Styles */
        button {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #007BFF;
            color: white;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Articles Section */
        .articles-section {
            margin-top: 2em;
        }

        .article {
            border: 1px solid #e0e0e0;
            padding: 1.5em;
            margin-bottom: 1.5em;
            border-radius: 10px;
            background-color: #fff;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .article:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .article h3 {
            margin-top: 0;
        }

        .article a {
            color: #007BFF;
            text-decoration: none;
            font-weight: 600;
        }

        .article a:hover {
            text-decoration: underline;
        }

        /* Biases and Export */
        .biases, .export-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 1.5em;
            align-items: center;
        }

        .biases label {
            display: flex;
            align-items: center;
            cursor: pointer;
            background: #f0f0f0;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .biases input[type="checkbox"] {
            margin-right: 8px;
        }

        .biases label:hover {
            background: #e0e0e0;
        }

        /* Status and Hidden Elements */
        #status {
            text-align: center;
            padding: 3em;
            font-size: 1.5em;
            color: #555;
        }

        .hidden {
            display: none;
        }

        /* Dataset Output */
        #dataset-output {
            background-color: #282c34;
            color: #abb2bf;
            padding: 1.5em;
            border-radius: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 1.5em;
            font-family: 'Courier New', Courier, monospace;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-size: 1em;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .toast.success {
            background-color: #28a745;
        }
        .toast.error {
            background-color: #dc3545;
        }

        /* Definitions Modal */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 1001; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.6);
            padding-top: 60px;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .definition {
            margin-bottom: 2em;
        }
        .definition h3 {
            color: #2c3e50;
            border-bottom: 2px solid #007BFF;
            padding-bottom: 0.5em;
        }
        .definition p {
            line-height: 1.6;
        }
        .definition .source {
            font-style: italic;
            font-size: 0.9em;
            color: #555;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div id="status">
        <p>Connecting to server...</p>
    </div>

    <div id="init-db-section" class="container hidden">
        <h1>Database Not Initialized</h1>
        <p>The required database table ('articles') does not exist. Please initialize it.</p>
        <button id="init-db-btn">Initialize Database</button>
    </div>

    <div id="main-content" class="container hidden">
        <h1>Article Manager</h1>

        <div class="form-section">
            <h2>Add New Article</h2>
            <form id="add-article-form">
                <input type="text" id="url" placeholder="URL" required>
                <textarea id="news_article" placeholder="News Article Content" rows="5" required></textarea>
                <textarea id="summary" placeholder="Summary" rows="3" required></textarea>
                <div class="biases">
                    <label><input type="checkbox" id="bias_political"> Political</label>
                    <label><input type="checkbox" id="bias_gender"> Gender</label>
                    <label><input type="checkbox" id="bias_cultural"> Cultural</label>
                    <label><input type="checkbox" id="bias_ideology"> Ideology</label>
                    <label><input type="checkbox" id="generated_by_ai"> Generated by AI</label>
                </div>
                <button type="submit">Add Article</button>
            </form>
        </div>

        <div class="articles-section">
            <h2>Saved Articles</h2>
            <button id="view-articles">Show Articles</button>
            <button id="view-definitions">View Definitions</button>
            <div class="export-buttons">
                <button id="export-csv">Export to CSV</button>
                <button id="export-parquet">Export to Parquet</button>
                <button id="export-dataset">Export for Dataset Library</button>
            </div>
            <div id="articles-list" style="display:none;"></div>
            <div id="dataset-output" style="display:none;"></div>
        </div>
    </div>

    <!-- The Definitions Modal -->
    <div id="definitions-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Bias Definitions</h2>
            <div class="definition">
                <h3>Political</h3>
                <p>People tend to understand the term "political bias" as "lack of neutrality" [2] and as unfair favoritism towards one political group, candidate or ideology [3]; and the pejorative connotation of "political bias"–much like that of "gender bias" or "racial bias"–suggests that whenever possible, politically biased acts should be identified as such, and a corrective action should be taken. Indeed, the essence of claims of political bias is a denunciation of apparent violations of political neutrality in settings where this norm is expected to apply–e.g., media coverage [4,5], legal and bureaucratic decisions [6–8], or academic teaching [9,10].</p>
                <p class="source">From: <a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC5933769/#sec001" target="_blank" rel="noopener noreferrer">https://pmc.ncbi.nlm.nih.gov/articles/PMC5933769/#sec001</a></p>
            </div>
            <div class="definition">
                <h3>Gender</h3>
                <p>Any one of a variety of stereotypical beliefs or biases about individuals on the basis of their gender. These biases can be expressed linguistically, as in use of the phrase physicians and their wives (instead of physicians and their partners, which avoids the implication that physicians must be male/masculine) or of the use of gender pronouns when people of all genders are being discussed.</p>
                <p class="source">From: <a href="https://dictionary.apa.org/gender-bias?6df6a1c6_page=4" target="_blank" rel="noopener noreferrer">https://dictionary.apa.org/gender-bias?6df6a1c6_page=4</a></p>
            </div>
            <div class="definition">
                <h3>Cultural</h3>
                <p>Cultural bias occurs when an individual or group imposes their cultural values and norms on other groups. Cultural bias assumes that one’s own culture is superior to others. When it is backed by social power, cultural bias can lead to policies and practices that demean, dismiss, and even destroy other cultures and the people in those cultures.</p>
                <p>Such individual and group bias becomes systemic when group bias is backed up by political, economic, and social systems. In those cases, respect and equity among cultural groups are sacrificed in favor of the dominant group and the cultural norms of the group.</p>
                <p class="source">From: <a href="https://www.r2hub.org/library/what-is-cultural-bias" target="_blank" rel="noopener noreferrer">https://www.r2hub.org/library/what-is-cultural-bias</a></p>
            </div>
            <div class="definition">
                <h3>Ideology</h3>
                <p>The ideology bias, also known as stance or framing bias, occurs when the issuer presents the information in a partial way. The author may be biased towards a certain ideology, which can influence the way they present information in their work. This can make it difficult for readers to assess the accuracy and impartiality of the information presented.</p>
                <p class="source">From: <a href="https://www.sciencedirect.com/science/article/pii/S0957417423021437" target="_blank" rel="noopener noreferrer">https://www.sciencedirect.com/science/article/pii/S0957417423021437</a></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const apiUrl = 'https://prisma-9040.onrender.com';

            const statusDiv = document.getElementById('status');
            const mainContent = document.getElementById('main-content');
            const initDbSection = document.getElementById('init-db-section');
            const initDbBtn = document.getElementById('init-db-btn');
            const addArticleForm = document.getElementById('add-article-form');
            const viewArticlesBtn = document.getElementById('view-articles');
            const exportCsvBtn = document.getElementById('export-csv');
            const exportParquetBtn = document.getElementById('export-parquet');
            const exportDatasetBtn = document.getElementById('export-dataset');
            const articlesList = document.getElementById('articles-list');
            const datasetOutput = document.getElementById('dataset-output');
            const viewDefinitionsBtn = document.getElementById('view-definitions');
            const definitionsModal = document.getElementById('definitions-modal');
            const closeBtn = document.querySelector('.close-btn');

            async function checkHealth() {
                try {
                    const response = await fetch(`${apiUrl}/health`);
                    const data = await response.json();

                    if (response.ok && data.status === 'ok') {
                        if (data.db_initialized) {
                            statusDiv.classList.add('hidden');
                            mainContent.classList.remove('hidden');
                            fadeIn(mainContent);
                        } else {
                            statusDiv.classList.add('hidden');
                            initDbSection.classList.remove('hidden');
                            fadeIn(initDbSection);
                        }
                    } else {
                        throw new Error(data.detail || 'Server not healthy');
                    }
                } catch (error) {
                    statusDiv.innerHTML = `<p style="color: red;">Error: Could not connect to the backend server. ${error.message}</p>`;
                    console.error('Health check failed:', error);
                }
            }

            initDbBtn.addEventListener('click', async () => {
                initDbBtn.disabled = true;
                initDbBtn.textContent = 'Initializing...';
                try {
                    const response = await fetch(`${apiUrl}/initialize-database`, { method: 'POST' });
                    const data = await response.json();

                    if (response.ok) {
                        showToast(data.message);
                        setTimeout(() => window.location.reload(), 2000);
                    } else {
                        showToast(`Error: ${data.detail}`, 'error');
                        initDbBtn.disabled = false;
                        initDbBtn.textContent = 'Initialize Database';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('Error connecting to the server.', 'error');
                    initDbBtn.disabled = false;
                    initDbBtn.textContent = 'Initialize Database';
                }
            });

            addArticleForm.addEventListener('submit', async function(event) {
                event.preventDefault();

                const article = {
                    url: document.getElementById('url').value,
                    news_article: document.getElementById('news_article').value,
                    summary: document.getElementById('summary').value,
                    bias_political: document.getElementById('bias_political').checked,
                    bias_gender: document.getElementById('bias_gender').checked,
                    bias_cultural: document.getElementById('bias_cultural').checked,
                    bias_ideology: document.getElementById('bias_ideology').checked,
                    generated_by_ai: document.getElementById('generated_by_ai').checked,
                };

                try {
                    const response = await fetch(`${apiUrl}/articles/`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(article)
                    });
                    if (response.ok) {
                        showToast('Article added successfully!');
                        addArticleForm.reset();
                        if (!articlesList.classList.contains('hidden')) {
                            loadArticles();
                        }
                    } else {
                        showToast('Failed to add article.', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('Error connecting to the server.', 'error');
                }
            });

            viewArticlesBtn.addEventListener('click', () => {
                if (articlesList.style.display === 'none' || articlesList.innerHTML === '') {
                    loadArticles();
                    articlesList.style.display = 'block';
                    viewArticlesBtn.textContent = 'Hide Articles';
                } else {
                    articlesList.style.display = 'none';
                    viewArticlesBtn.textContent = 'Show Articles';
                }
            });

            exportCsvBtn.addEventListener('click', () => {
                window.location.href = `${apiUrl}/articles/csv`;
            });

            exportParquetBtn.addEventListener('click', () => {
                window.location.href = `${apiUrl}/articles/parquet`;
            });

            exportDatasetBtn.addEventListener('click', async () => {
                try {
                    const response = await fetch(`${apiUrl}/articles/dataset`);
                    const data = await response.json();
                    datasetOutput.textContent = JSON.stringify(data, null, 2);
                    datasetOutput.style.display = 'block';
                    fadeIn(datasetOutput);
                } catch (error) {
                    console.error('Error:', error);
                    showToast('Error fetching dataset format.', 'error');
                }
            });

            // Definitions Modal Logic
            viewDefinitionsBtn.addEventListener('click', () => {
                definitionsModal.style.display = 'block';
            });

            closeBtn.addEventListener('click', () => {
                definitionsModal.style.display = 'none';
            });

            window.addEventListener('click', (event) => {
                if (event.target == definitionsModal) {
                    definitionsModal.style.display = 'none';
                }
            });

            async function loadArticles() {
                try {
                    const response = await fetch(`${apiUrl}/articles/`);
                    const articles = await response.json();
                    articlesList.innerHTML = '';
                    if (articles.length === 0) {
                        articlesList.innerHTML = '<p>No articles found.</p>';
                        return;
                    }
                    articles.forEach(article => {
                        const articleDiv = document.createElement('div');
                        articleDiv.className = 'article';
                        let biases = [];
                        if (article.bias_political) biases.push('Political');
                        if (article.bias_gender) biases.push('Gender');
                        if (article.bias_cultural) biases.push('Cultural');
                        if (article.bias_ideology) biases.push('Ideology');
                        if (article.generated_by_ai) biases.push('Generated by AI');

                        articleDiv.innerHTML = `
                            <h3><a href="${article.url}" target="_blank" rel="noopener noreferrer">${article.url}</a></h3>
                            <p><strong>Article:</strong> ${article.news_article}</p>
                            <p><strong>Summary:</strong> ${article.summary}</p>
                            <p><strong>Biases:</strong> ${biases.join(', ') || 'None'}</p>
                        `;
                        articlesList.appendChild(articleDiv);
                        fadeIn(articleDiv);
                    });
                } catch (error) {
                    console.error('Error:', error);
                    showToast('Error fetching articles.', 'error');
                }
            }

            function fadeIn(element) {
                let op = 0.1;
                element.style.display = 'block';
                let timer = setInterval(function () {
                    if (op >= 1){
                        clearInterval(timer);
                    }
                    element.style.opacity = op;
                    element.style.filter = 'alpha(opacity=' + op * 100 + ")";
                    op += op * 0.1;
                }, 10);
            }

            function showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.className = `toast ${type}`;
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.remove();
                }, 3000);
            }
            
            // Initial health check
            checkHealth();
        });
    </script>
</body>
</html>
